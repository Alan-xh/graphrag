# 索引方法

GraphRAG 是一个用于研究 RAG 索引方法的平台，旨在为语言模型生成最优的上下文窗口内容。我们有一个标准的索引管道，使用语言模型提取我们的记忆模型所基于的图结构。我们可能会不时引入其他索引方法。本页面记录了这些选项。

## 标准 GraphRAG

这是原始[博客文章](https://www.microsoft.com/en-us/research/blog/graphrag-unlocking-llm-discovery-on-narrative-private-data/)中描述的方法。标准方法使用语言模型完成所有推理任务：

- 实体提取：提示语言模型从每个文本单元中提取命名实体并提供描述。
- 关系提取：提示语言模型描述每个文本单元中实体对之间的关系。
- 实体总结：提示语言模型将跨文本单元发现的每个实体的描述合并为单一总结。
- 关系总结：提示语言模型将跨文本单元发现的每个关系的描述合并为单一总结。
- 声明提取（可选）：提示语言模型从每个文本单元中提取并描述声明。
- 社区报告生成：收集每个社区的实体和关系描述（以及可选的声明），并用这些内容提示语言模型生成总结报告。

`graphrag index --method standard`。这是默认方法，因此方法参数实际上可以省略。

## 快速 GraphRAG

快速 GraphRAG 是一种用传统自然语言处理（NLP）方法替代部分语言模型推理的方法。这是一种我们开发的更快、更便宜的索引替代方案：

- 实体提取：实体是使用 NLTK 和 spaCy 等 NLP 库提取的名词短语。没有描述；使用源文本单元。
- 关系提取：关系定义为实体对之间的文本单元共现。没有描述。
- 实体总结：不需要。
- 关系总结：不需要。
- 声明提取（可选）：未使用。
- 社区报告生成：收集包含每个实体名词短语的直接文本单元内容，并用这些内容提示语言模型生成总结报告。

`graphrag index --method fast`

快速 GraphRAG 内置了一些 NLP [选项](https://microsoft.github.io/graphrag/config/yaml/#extract_graph_nlp)。默认情况下，我们使用 NLTK + 正则表达式进行名词短语提取，这非常快，但主要适用于英语。我们还内置了两种使用 spaCy 的方法：语义解析和 CFG。我们默认使用 spaCy 的 `en_core_web_md` 模型，但请注意，您可以引用已安装的任何[支持模型](https://spacy.io/models/)。

请注意，我们通常将文本分块配置为生成更小的块（50-100 个标记）。这会生成更好的共现图。

⚠️ 关于 SpaCy 模型的说明：

此包需要 SpaCy 模型才能正常运行。如果未安装所需模型，包将在首次使用时自动下载并安装。

您可以通过运行 `python -m spacy download <model_name>` 手动安装，例如 `python -m spacy download en_core_web_md`。

## 选择方法

标准 GraphRAG 提供了对现实世界实体和关系的丰富描述，但比快速 GraphRAG 更昂贵。我们估计图提取约占索引成本的 75%。因此，快速 GraphRAG 成本低得多，但代价是提取的图在 GraphRAG 之外的直接相关性较低，且图通常会更嘈杂。如果高保真实体和图探索对您的用例很重要，我们建议使用传统 GraphRAG。如果您的用例主要针对使用全局搜索的总结问题，快速 GraphRAG 是一个合理且更便宜的替代方案。