# 输入

GraphRAG 支持多种输入格式，以简化数据摄入。以下讨论了输入文件和文本分块的机制及可用功能。

## 输入加载和模式

所有输入格式都在 GraphRAG 中加载，并作为 `documents` DataFrame 传递到索引管道。此 DataFrame 为每个文档提供一行，使用共享的列模式：

| 名称          | 类型 | 描述 |
| ------------- | ---- | ----------- |
| id            | str  | 文档的 ID。通过对文本内容进行哈希生成，以确保跨运行的稳定性。 |
| text          | str  | 文档的完整文本。 |
| title         | str  | 文档的名称。某些格式允许配置此项。 |
| creation_date | str  | 文档的创建日期，以 ISO8601 字符串表示。从源文件系统中获取。 |
| metadata      | dict | 可选的附加文档元数据。详情见下文。 |

另请参阅 [输出](outputs.md) 文档，了解管道完成后保存到 parquet 的最终文档表模式。

## 格式

我们开箱即支持三种文件格式。这涵盖了我们遇到的绝大多数用例。如果您有其他格式，建议编写脚本将其转换为以下任一格式，这些格式被广泛使用并得到许多工具和库的支持。

### 纯文本

纯文本文件（通常以 .txt 文件扩展名结尾）。对于纯文本文件，我们将整个文件内容导入为 `text` 字段，`title` 始终为文件名。

### 逗号分隔

CSV 文件（通常以 .csv 扩展名结尾）。这些文件使用 pandas 的 [`read_csv` 方法](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html) 加载，采用默认选项。CSV 文件中的每行被视为一个单独的文档。如果您的输入文件夹中有多个 CSV 文件，它们将被连接成一个最终的 `documents` DataFrame。

对于 CSV 格式，您可以配置 `text_column` 和 `title_column`，如果您的数据具有您希望使用的结构化内容。如果您在 settings.yaml 的 `input` 块中未配置这些，标题将如上文模式所述为文件名。如果未特别配置，`text_column` 假设为文件中的 "text"。如果存在 "id" 列，我们也会查找并使用它，否则将如上所述生成 ID。

### JSON

JSON 文件（通常以 .json 扩展名结尾）包含 [结构化对象](https://www.json.org/)。这些文件使用 Python 的 [`json.loads` 方法](https://docs.python.org/3/library/json.html) 加载，因此您的文件必须完全合规。JSON 文件可以包含单个对象，或者文件根目录可能包含一个对象数组。我们会检查并处理这两种情况。与 CSV 类似，多个文件将被连接成最终表，并将应用 `text_column` 和 `title_column` 配置选项。请注意，某些库生成的专用 jsonl 格式（每行一个完整的 JSON 对象，不在数组中）目前不受支持。

## 元数据

对于结构化文件格式（CSV 和 JSON），您可以配置任意数量的列，添加到持久化的 `metadata` 字段中。这是通过提供要收集的列名列表来配置的。如果配置了此项，输出的 `metadata` 列将包含一个字典，其中包含每个列的键，以及该文档的列值。此元数据可以在 GraphRAG 管道的后续步骤中选择性使用。

### 示例

software.csv

```csv
text,title,tag
My first program,Hello World,tutorial
An early space shooter game,Space Invaders,arcade
```

settings.yaml

```yaml
input:
    metadata: [title,tag]
```

文档 DataFrame

| id                    | title          | text                        | creation_date                 | metadata                                       |
| --------------------- | -------------- | --------------------------- | ----------------------------- | ---------------------------------------------- |
| (基于文本生成)        | Hello World    | My first program            | (software.csv 的创建日期)     | { "title": "Hello World", "tag": "tutorial" }  |
| (基于文本生成)        | Space Invaders | An early space shooter game | (software.csv 的创建日期)     | { "title": "Space Invaders", "tag": "arcade" } |

## 分块和元数据

如 [默认数据流](default_dataflow.md#phase-1-compose-textunits) 页面所述，文档会被 *分块* 成较小的“文本单元”进行处理。这是由于文档内容大小通常超过给定语言模型的可用上下文窗口。您可以调整分块的几个设置，最相关的是 `chunk_size` 和 `overlap`。我们现在还支持一种元数据处理方案，可以改善某些用例的索引结果。我们将在此详细描述此功能。

想象以下场景：您正在索引一组新闻文章。每篇文章的文本以标题和作者开头，然后是内容。当文档被分块时，它们会根据您配置的块大小均匀分割。换句话说，前 *n* 个令牌被读入一个文本单元，然后是下一个 *n* 个，直到内容结束。这意味着文档开头的前置内容（例如本例中的标题和作者）*不会被复制到每个块中*。它仅存在于第一个块中。当我们随后检索这些块进行摘要时，它们可能缺少应始终提供给模型的源文档的共享信息。我们提供了配置选项，将重复内容复制到每个文本单元中，以解决此问题。

### 输入配置

如上所述，当导入文档时，您可以指定包含在每行中的 `metadata` 列列表。必须配置此项，以使每个块的复制功能生效。

### 分块配置

接下来，`chunks` 块需要指示分块器在创建文本单元时如何处理这些元数据。默认情况下，它会被忽略。我们有两个设置来包含它：

- `prepend_metadata`。这指示导入器将每行的 `metadata` 列内容复制到每个文本块的开头。元数据以键值对的形式在新行上复制。
- `chunk_size_includes_metadata`：这告诉分块器在包含元数据时如何计算块大小。默认情况下，我们使用您指定的 `chunk_size` 创建文本单元，*然后* 预置元数据。这意味着最终文本单元的长度可能比您配置的 `chunk_size` 长，并且会根据每个文档的元数据长度而变化。当此设置为 `True` 时，我们会在测量元数据长度后使用剩余部分计算原始文本，以确保生成的文本单元始终符合您配置的 `chunk_size`。

### 示例

以下是几个示例，以帮助说明分块配置和元数据预置如何为每种文件格式工作。请注意，我们在此处使用字数作为“令牌”进行说明，但语言模型令牌 [与单词不等价](https://help.openai.com/en/articles/4936856-what-are-tokens-and-how-to-count-them)。

#### 文本文件

本示例使用两个单独的新闻文章文本文件。

--

**文件：** 美国将取消大部分联邦 COVID-19 疫苗要求.txt

**内容：**

华盛顿（美联社）白宫周一表示，拜登政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求。联邦工作人员、联邦承包商以及赴美外国航空旅客的疫苗要求将于 5 月 11 日结束。政府还开始着手取消对 Head Start 教育工作者、医疗工作者和美国陆地边境非公民的疫苗要求。这些要求是联邦政府为促进疫苗接种而采取的一些更具强制性措施的最后痕迹，当时致命病毒肆虐，它们的结束标志着拜登政府如何将 COVID-19 视为一种常规、地方性疾病的最新体现。白宫 COVID-19 协调员阿什什·贾博士周一对美联社表示：“虽然我认为这些疫苗要求产生了巨大的积极影响，但我们现在认为取消这些要求非常合理。”

--

**文件：** 纽约州议员在一个月后开始辩论预算.txt

**内容：**

奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一项一个月前到期的 2290 亿美元州预算，该预算将提高最低工资、打击非法大麻店并禁止在新建筑中使用燃气灶和炉具。州长凯西·霍赫尔及其控制立法机构的民主党同僚的谈判因对保释法和其他政策提案的分歧而拖延至 4 月 1 日预算截止日期之后。一些预算法案的floor辩论于周一开始。州参议院多数党领袖安德烈娅·斯图尔特-考辛斯表示，她预计投票将在周二结束，她说该预算为纽约人带来了“重大胜利”。“我希望能早点完成这件事。我想我们都同意这一点，”考辛斯在投票开始前对记者说。“这是一个政策繁重的预算，许多政策需要仔细解析。”霍赫尔成功推动了一项保释法改革，取消了要求法官规定确保被告返回法庭的“最少限制”手段的标准。霍赫尔表示，法官需要额外的自由裁量权。一些自由派议员认为，这将削弱 2019 年批准的全面保释改革，导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含在预算中的其他政策条款。最低工资将在 2026 年前在纽约市及其部分郊区提高到 17 美元，在州内其他地区提高到 16 美元。这比纽约市的 15 美元和州内其他地区的 14.20 美元有所提高。

--

settings.yaml

```yaml
input:
    file_type: text
    metadata: [title]

chunks:
    size: 100
    overlap: 0
    prepend_metadata: true
    chunk_size_includes_metadata: false
```

文档 DataFrame

| id                    | title                                                         | text                        | creation_date                     | metadata                                                                     |
| --------------------- | ------------------------------------------------------------- | --------------------------- | --------------------------------- | ---------------------------------------------------------------------------- |
| (基于文本生成)        | 美国将取消大部分联邦 COVID-19 疫苗要求.txt                     | (文本文件完整内容)     | (文章 txt 文件的创建日期)          | { "title": "美国将取消大部分联邦 COVID-19 疫苗要求.txt" }                     |
| (基于文本生成)        | 纽约州议员在一个月后开始辩论预算.txt                           | (文本文件完整内容)    | (文章 txt 文件的创建日期)          | { "title": "纽约州议员在一个月后开始辩论预算.txt" }                           |

原始文本块

| content            | length  |
|--------------------|---------|
| title: 美国将取消大部分联邦 COVID-19 疫苗要求.txt<br>华盛顿（美联社）白宫政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求，白宫周一表示。联邦工作人员、联邦承包商以及赴美外国航空旅客的疫苗要求将于 5 月 11 日结束。政府还开始制定取消对 Head Start 教育工作者、医疗工作者和美国边境的非公民的疫苗要求的流程。这些要求是联邦政府为促进疫苗接种采取的一些更强制性措施的最后痕迹，因为 | 109 |
| title: 美国将取消大部分联邦 COVID-19 疫苗要求.txt<br>致命病毒肆虐，它们的结束标志着拜登总统的政府如何将 COVID-19 视为一种常规、地方性疾病的最新体现。“虽然我认为这些疫苗要求具有巨大的益处，但我们现在是时候认为撤销这些要求是合理的，”白宫 COVID-19 协调员阿什什·贾博士周一对美联社表示。 | 82 |
| title: 纽约州议员在一个月后开始辩论预算.txt<br>奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一个月前到期的 2290 亿美元州预算，旨在提高最低工资，打击非法大麻店并禁止在新建筑物中使用燃气灶和炉具。州长凯西·霍赫尔及其控制立法机构的民主党同僚的谈判因对保释法和其他政策提案的分歧而拖延至 4 月 1 日预算截止日期之后。一些预算案的floor辩论于周一开始。州参议院多数领袖安德烈娅·斯图尔特-考辛斯表示，她预计投票将在 | 111 |
| title: 纽约州议员在一个月后开始辩论预算.txt<br>周二结束，她说这个预算为纽约人带来了“重大胜利”。“我希望能早点完成这件事。我想我们都同意这一点，”考辛斯在投票开始前对记者说。“这是一个非常政策密集的预算，许多政策需要处理。” 霍赫尔成功推动了一项对保释法的修改，取消了要求法官规定“最少限制”以确保被告返回法庭的标准。霍赫尔说，法官需要额外的自由裁量权。一些自由派人物认为，它将 | 111 |
| title: 纽约州议员在一个月后开始辩论预算.txt<br>削弱了2019年批准的全面保释改革，并导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含在预算中的其他政策条款。最低工资将在2026年前在纽约市及其部分郊区提高到$17，在州内其他地区提高到$16。这比纽约市的$15和州内其他地区的$14.20有所提高。 | 89 |

在此示例中，我们可以看到两个输入文档被解析为五个输出文本单元。每个文档的标题（文件名）都被预置，但不包括在计算的块大小中。另请注意，每个文档的最后一个文本块通常小于块大小，因为它包含最后的令牌。

#### CSV 文件

本示例使用单个 CSV 文件，包含与前述相同的两篇文章作为行（请注意，文本内容未针对实际 CSV 使用正确转义）。

--

**文件：** articles.csv

**内容**

```csv
headline,article
美国将取消大部分联邦 COVID-19 疫苗要求,华盛顿（美联社）白宫政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求，白宫周一表示。联邦工作人员、联邦承包商以及赴美外国航空旅客的疫苗要求将于 5 月 11 日结束。政府还开始制定取消对 Head Start 教育工作者、医疗工作者和美国边境的非公民的疫苗要求的过程。这些要求是联邦政府为促进疫苗接种采取的一些更强制性措施的最后痕迹，因为致命病毒肆虐，其结束标志着拜登总统的政府如何将 COVID-19视为一种常规、地方性疾病的最新体现。“虽然我认为这些疫苗要求具有巨大的益处，但我们现在是时候认为撤销这些要求是非常合理的，”白宫 COVID-19 协调员阿什什·贾博士周一对美联社表示。
纽约州议员在一个月后开始辩论预算，奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一个月前到期的 2290 亿美元州预算，旨在提高最低工资、打击非法大麻店并禁止在新建筑物中使用燃气灶。州长凯西·霍赫尔及其控制立法机构的民主党同僚的谈判因对保释法修改和其他政策提议的分歧而拖延至 4 月 1 日预算截止日期之后。一些预算案的floor辩论于周一开始。州参议院多数领袖安德烈娅·斯图尔特-考辛斯表示，她预计投票将在周二结束，她说这个预算为纽约人带来了“重大胜利”。“我希望能早点完成这件事。我想我们都同意这一点”，考辛斯在投票开始前对记者说。“这是一个非常政策密集的预算，许多政策需要处理。” 霍赫尔成功通过了一项对保释法的修改，取消了要求法官规定“最少限制”的标准，以确保被告返回法庭。霍赫尔说，法官需要额外的自由裁量权。一些自由派议员认为，这将削弱2019年批准的全面保释改革，导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含在预算中的其他政策条款。最低工资将在2026年前在纽约市及其部分郊区提高到 $17，在州内其他地区提高到 $16。这比纽约市的 $15 和州内其他地区的 $14.20 有所提高。
```

--

settings.yaml

```yaml
input:
    file_type: csv
    title_column: headline
    text_column: article
    metadata: [headline]

chunks:
    size: 50
    overlap: 5
    prepend_metadata: true
    chunk_size_includes_metadata: true
```

文档 DataFrame

| id                    | title                                                     | text                        | creation_date                     | metadata                                                                     |
|------------------------|-----------------------------------------------------------|-----------------------------|-----------------------------------|------------------------------------------------------------------------------|
| (基于文本生成)         | 美国将取消大部分联邦 COVID-19 疫苗要求                     | (article 列内容)         | (articles.csv 的创建日期)         | { "headline": "美国将取消大部分联邦 COVID-19 疫苗要求" }                        |
| (基于文本生成)            | 纽约州议员在一个月后开始辩论预算                   | (article column content) | (文章列内容) | (articles.csv) (创建日期 of articles.csv) | { "headline": "纽约州议员在一个月后开始辩论预算" } |

原始文本块

| content                                                                 | length  |
|----------------------------------------------------------------------|---------|
| title: 美国将取消大部分联邦 COVID-19 疫苗要求<br>华盛顿（美联社）白宫政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求，白宫周一表示。 | 50 |
| title: 美国将取消大部分联邦 COVID-19 疫苗要求<br>联邦工作人员和联邦承包商以及赴美外国航空旅客。将于 5 月 11 日结束。政府还开始制定取消对 Head Start 教育工作者、医疗工作者和美国边境的非公民的疫苗要求的过程。 | 50 |
| title: 美国将取消大部分联邦 COVID-19 疫苗要求<br>美国边境的非公民。的要求是联邦政府为采取的一些更强制执行措施的最后痕迹，以促进疫苗接种。 | 50 |
| title: 美国将取消大部分联邦 COVID-19 疫苗要求<br>最新进展显示，总统拜登的政府如何将 COVID-19视为一种常规的、地方性疾病。“虽然我认为这些疫苗要求具有巨大的益处，我们现在认为时候是撤销这些要求的点，” | 50 |
| title: 美国将取消大部分联邦 COVID-19 疫苗要求<br>我们现在认为撤销这些要求是非常合理的时间点，”白宫 COVID-19 协调员阿什什·哈博士周一对美联社表示。 | 38 |
| title: 纽约州议员在一个月后开始辩论预算<br>奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一个月前到期的 2290 亿美元州预算，旨在提高最低工资，打击非法大麻店并禁止在新的建筑物中取得燃气灶。 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>燃气炉。新的建筑物中，州长凯西·霍赫尔及其控制立法机构的民主党同僚的谈判因拖延至 4 月 1 日预算截止日期。 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>其他政策提议包含在支出计划中。一些预算法案的floor辩论于周一开始讨论。州参议院多数领袖安德烈娅·斯图尔特-考斯表示，她预计投票将在周二结束预算 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>结束，她说这个预算为纽约人带来了“重大胜利”。“我希望能早点完成这件事。我想我们都同意这一点，”考辛斯特在投票开始前对记者说。“这是一个” | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>记者说。“这是一个非常政策密集的预算，许多政策需要处理。” 霍赫尔成功通过了一项对保释法的修改，取消要求法官 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>取消要求法官规定“最少限制”的方式，以确保被告返回法庭。霍赫尔说，法官需要额外的自由裁量权。一些自由派议员认为它将削弱2019年批准的全面保释改革 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>2019年批准的保释改革，并导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含在预算中的其他政策条款。最低 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>条款。最低工资将提高到 $17 在纽约市及其部分郊区，2026年由州内其他地区提高到 $16。这比 | 50 |
| title: 纽约州议员在一个月后开始辩论预算<br>2026。这比纽约市的 $15 和 | 22 |

在此示例中，我们可以看到两个输入文档被解析为十四个输出文本块。每个文档的标题（headline 头条）都被预置，并包含在计算的块大小中，因此每个块匹配配置的块大小（除了每个文档的最后一个）。我们还配置了这些文本块的一些重叠，因此最后五个令牌是共享的。为什么要使用文本块重叠？考虑到当您基于令牌分割文档时，句子甚至相关概念很可能会被分割到不同的块中。每个文本块由语言模型单独处理，因此可能导致块边界处“想法”不完整。重叠确保这些分割的概念在至少一个块中完全包含。

#### JSON 文件

最后一个示例为每篇相同的两篇文章使用一个 JSON 文件。在本例中，我们将设置要读取的对象字段，但不会将元数据添加到文本块中。

--

**文件：** article1.json

**内容：**

```json
{
    "headline": "美国将取消大部分联邦 COVID-19 疫苗要求",
    "content": "华盛顿（美联社）白宫政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求，白宫周一表示。联邦工作人员、联邦承包商以及赴美外国航空旅客的疫苗要求将于 5 月 11 日结束。政府还开始制定取消对 Head Start 教育工作者、医疗工作者和美国边境的非公民的疫苗要求的过程。这些要求是联邦政府为采取的一些更强制性措施的最后痕迹，以促进疫苗接种，因为致命病毒肆虐，其结束标志着拜登总统的政府如何将 COVID-19 视为一种常规的、地方性疾病的最新体现。「虽然我认为这些疫苗要求具有巨大的作用，但我们现在认为时候是撤销这些要求的时间点，”白宫 COVID-19 协调员阿什什·贾博士周一对美聯社表示。"
}
```

**文件：** article2.json

**内容：**

```json
{
    "headline": "纽约州议员在一个月后开始辩论预算",
    "content": "奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一个月前到期的 2290 亿美元州预算，旨在提高最低工资、打击非法大麻店并禁止在新建筑物中使用燃气灶和炉具。州长凯西·霍赫尔及其控制立法机构的民主党同僚的谈判因对保释法和其他政策提议的分歧而拖延至 4 月 1 日预算截止日期之后。一些预算案的floor辩论于周一开始。州参议院多数派领袖安德烈娅·斯图尔特-考辛斯表示，她预计投票将在周二结束，她说这个预算为纽约人带来了“重大胜利”。“我希望能早点完成这件事。我想我们都同意这一点，”考辛斯在投票开始前对记者说。“这是一个非常政策密集的预算，许多政策需要处理。” 霍赫尔成功通过了一项对保释法的修改，取消了要求法官规定“最少限制”的标准，以确保被告返回法庭。霍赫尔说，法官需要额外的自由裁量权。一些自由派议员认为，这将削弱2019年批准的全面保释改革，导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含在预算中的其他政策条款。最低工资将在2026年前在纽约市及其部分郊区提高到 $17，在州内其他地区提高到 $16。这比纽约市的 $15 和州内其他地区的 $14.20 有所提高。"
}
```

--

settings.yaml

```yaml
input:
    file_type: json
    title_column: headline
    text_column: content

chunks:
    size: 100
    overlap: 10
```

文档 DataFrame

| id                    | title                                                     | text                        | creation_date                     | metadata |
|-----------------------|-----------------------------------------------------------|-----------------------------|-----------------------------------|----------|
| (基于文本生成)         | 美国将取消大部分联邦 COVID-19 疫苗要求                  | (article content 列内容)     | (article1.json 的创建日期)        | {}       |
| (基于文本生成)        | 纽约州议员在一个月后开始辩论预算                   | (article column content) (文章内容) | (article2.json 的创建日期)        | {}       |

原始文本块

| content                                                                 | length  |
|-------------------------------------------------------------------------|--------|
| 华盛顿（美联社）白宫政府将在下周结束全国公共卫生紧急状态时，终止最后剩余的大部分联邦 COVID-19 疫苗要求，白宫周一表示。联邦工作人员、联邦承包商以及赴美外国航空旅客的疫苗要求将于 5 月 11 日结束。政府还开始制定取消对 Head Start 教育工作者、医疗工作者 REGISTRY 和健康工作者和美国边境的非公民的疫苗要求。这些要求是 | 100    |
| 采取的一些措施，以促进疫苗接种，因为致命的病毒肆虐，其结束标志着总统拜登的政府如何将 COVID-19 视为一种常规的、地方性疾病的最新体现。“                | 83     |
| 奥尔巴尼，纽约（美联社）纽约州议员周一开始投票表决一个月前到期的 2290 亿美元州预算，旨在提高最低工资，打击非法大麻店并禁止在新的建筑物中使用燃气灶。州长凯西·谢赫尔及其控制立法机构的民主党同僚之间，谈判因拖延至 4 月 1 日 | 100    |
| 参议院多数派领袖安德烈娅·斯图尔特-考辛斯特斯表示，她预计投票将在周二结束，她说这个预算为纽约人带来了“重大胜利”。“我希望能早一些完成。我认为我们都同意这一点”，”“考辛斯在投票开始之前对记者说。“这是一个非常政策密集的政策” 霍赫尔 | 100    |
| 以确保被告返回法庭。霍赫尔说，法官需要额外的自由裁量权。一些自由派议员认为，这将削弱2019年批准的全面保释改革，导致更多低收入和有色人种在审前被拘留。以下是州官员表示将包含的其余政策条款。最低工资将在2026年提高到 | 98     |

在此示例中，两个输入文档被解析为五个输出文本块。没有预置的元数据，因此每个块匹配配置的块大小（除了每个文档的最后一个）。我们还配置了一些这些文本块中的重叠，因此最后十个令牌是共享的。